---
title: 'Effects of increased specialization and hatchery production on revenue variability for individual Alaskan salmon fishers'
author: "Eric, Sean, Ole, Rich, Jordan, Jen, Anne, Alan, Milo, Ben"
date: ''
output:
  pdf_document:
    fig_caption: yes
  html_document: default
  word_document: default
bibliography: CatchPortfolios_salmon.bib
---

```{r setup, include=FALSE, echo=FALSE}
knitr::opts_chunk$set(echo = TRUE, tidy=FALSE, tidy.opts=list(width.cutoff=60), warning = FALSE, message = FALSE)
library(knitr)
library(tidyverse)
library(ggsidekick)
library(ggrepel)
library(reshape2)
library(date)
library(mgcv)
library(gridExtra)
library(zoo)
library(rstan)
library(ggrepel)
library(cowplot)
modelname = "model-linear" # model-linear-nointeractions
```

## Abstract
\setlength\parindent{24pt}

On a large scale, individual fishers may experience positive outcomes from diversifying their catches; benefits may include reduced year-to-year variability in annual revenue or increases in average revenue. Fishers can increase the species diversity of their catch by owning fishing permits that allow multiple species to be targeted, or by owning multiple permits. However, external factors such as management regulations (limited entry,  catch share programs), the number of permits available, or market forces (permit or fish prices) may disincentive individuals to hold multiple permits. Thus, individuals holding a single permit may only be able to increase species diversity within the confines of their permit (longer fishing seasons, broader spatial area). Using a 41 year dataset of individual salmon fishers in Alaska, we develop new models for understanding how the effects of diversification have changed through time. Applying these models to six diverse seine and gillnet fisheries, we find that the majority of these fisheries have experienced reduced diversity in catches through time, and increasing benefits of specialization on mean individual revenues. One of the mechanisms that has been hypothesized to reduce catch variability in Alaska has been increased hatchery production; however, our regional models suggest that fisheries experience little change in variability as a result of increased hatchery influence. 

## Introduction

[broader paragraph on diversification with extensions -- somewhat depends on journal, ]

Previous analyses have largely focused on patterns of diversification across ecosystems and the benefits to adopt more or less diverse fishing strategies [@kasperski2013; @anderson_benefits]. Fisheries in Alaska have been studied extensively, because they are one of the most productive seafood regions in the world (both by landed weight, and revenue [@officeofscienceandtechnology2016; @fissel2016]) and they allow individuals to adopt a wide range of fishing strategies. [@anderson_benefits] defined fishing strategies as a permit or collection of permits held by single individuals. Buying new permits allows individuals to fish in more regions or target additional species. Some of these permits in Alaskan waters allow only one species to be targeted (e.g. sablefish, herring, crab, shellfish, and sea cucumber), while others allow for multiple species (federally managed groundfish fisheries, state managed salmon fisheries). 
  
Understanding the effects of species diversification for individuals participating in salmon fisheries is particularly important because the proportion of salmon specialists (defined as individuals whose fishing revenue comes from a single salmon permit) have increased over the last 30 years, and annual revenue from these salmon specialists has recently exceeded all other fisheries combined [@anderson_benefits]. General trends in limited entry salmon fisheries since the early 2000s are that more individuals have been participating, landings are increasing, revenue is increasing slightly, and effective species diversity is declining over time (Fig. 1; Figs. A1-A4). Across salmon fisheries, there appears to be little correlation between catch diversity and revenue (Fig. A2), though fisheries cluster similarly by gear on axes of risk (CV of annual revenue) and return  (mean annual revenue, Fig. 2). Like in terrestrial agriculture [@purdy1997], fishing diversification may affect the mean or CV of revenue, but not both. Furthermore, any benefits or costs of fishers diversifying may be variable through time.  
  
Five species of salmon are harvested in Alaska waters (Chinook [*Oncorhynchus tshawytscha*], chum [*O. keta*], pink [*O. gorbuscha*], sockeye [*O. nerka*], coho [*O. kisutch*]), and the ability of individual salmon fishers to diversify across species is in part a function of geography and fishing gears. For example, salmon may be caught with purse seine gear (6 areas), drift gillnets (5 areas), or set gillnets (12 areas). Other gears include beach seine and troll gears (though these are generally restricted to Kodiak and Southeast Alaska). While multiple salmon species are targeted in some of these fisheries, there are also examples of fisheries where catch is dominated by a single species. Examples of specialization include fisheries that target sockeye salmon (e.g. Bristol Bay set and drift gillnet fisheries). For these fisheries, specialization is associated with higher revenue and reduced CV in year-to-year revenue [@anderson_benefits].  

Mechanisms responsible for incentivizing specialization or diversification are complex, but include a number of exogenous drivers, such as competition from markets producing farmed salmon, consolidation of salmon buyers, marketing, prices, and new processing technology [@knapp_trends]. In the late 1980s and early 1990s for example, salmon abundance was high and prices were low (in part due to collapses of foreign currencies). Following price declines into the early 2000s [@adfg2007], some of these trends have more recently reversed (increasing prices and catches, Figs. A5-A8). New technology such as freezing may increase competition within fisheries [@knapp_trends]; for example, large harvests of some species may have a negative impact on future prices (Supplementary Information). 

Perhaps one of the largest changes affecting the availability or incentives of fishers to diversify has been a general increase in the production of hatchery fish. The modern era of Alaska's large-scale hatchery program began in the late 1970s [@stopha2016; @ward_evaluating], with substantial increases in hatchery releases during the 1980s following low returns [@mahnken1998; @leber2008]. Many of these hatchery programs increased production in an effort to stabilize the variability of salmon catches [@hilborn2001a], though quantitative support for a reduction in variability (at the level of fisheries or individuals) remains unclear. Previous work has largely concentrated on ecological effects of hatcheries [@hilborn1992a; @hilborn2001a; @wertheimer2001; @heard_hatchery; @ruggerone2015], or economic yield [@boyce1993; @leber2008]. Understanding the role salmon have in buffering or stabilizing fishing revenues is critical given the responses of salmon to variable ocean environments [@mueter2002; @schindler2010].  

The objectives of our analysis are to (1) evaluate long term trends in catch stability and to evaluate whether hatchery production has increased catch stability, and (2) to better understand the effects of diversification on single-permit salmon holders by extending the time series models of individual revenues used by [@anderson_benefits] to include time-varying effects. These time-varying effects of diversification will allow us to compare temporal trends across regions and identify periods when having a diverse catch portfolio was most beneficial.  

## Methods

### Data  
  
We obtained fisheries landings and revenue data for all permit holders in Alaska from 1985--2016 from the Commercial Fisheries Entry Commission (CFEC). Reported gross earnings (revenue) associated with each fish ticket were adjusted for inflation by converting all revenues to 2009 USD [@bea2016]. Each fish ticket was associated with both a vessel and individual fisher, and because of our focus on individuals, we aggregated data by individuals to generate annual summaries of catch diversity and revenue. Because our modeling focus involves estimating time-varying effects of diversification, we limited our analysis to salmon fisheries with species diversity > 1 (omitting fisheries such as the Bristol Bay gillnet fisheries that specialize on sockeye salmon). To better understand the influence of changing hatchery production, we also restricted fisheries to those that have been influenced by hatcheries. 

```{r, echo=FALSE}
m = matrix("", 6, 3)
m[1,] = c("S01A", "Purse Seine", "Southeast Alaska")
m[2,] = c("S01E", "Purse Seine", "Prince William Sound")
m[3,] = c("S01K", "Purse Seine", "Kodiak")
m[4,] = c("S01M", "Purse Seine", "Alaska Peninsula")
m[5,] = c("S03A", "Gillnet", "Southeast Alaska")
m[6,] = c("S03E", "Gillnet", "Prince William Sound")
colnames(m) = c("Fishery (permit)", "Gear", "Region")
kable(m)
```

### Has increased hatchery production stabilized Alaskan salmon fisheries?
  
To understand long-term change in variability of Alaska salmon fisheries, it is important to understand how hatchery production has affected the mean revenue and variability in revenue. For consistency with previous work, we examined the stability in the catch (weight of salmon species [@hilborn2001a; @knapp2007], rather than revenue. Within each region in our analysis (Prince William Sound, Southeast, Kodiak, Alaska Peninsula), we used the hatchery contribution to the Common Property Commercial Harvest as the predictor variable, and total harvest as the response [@stopha2016]. These quantities are estimated at the coarse scale by region (Fig. 3), but not at the level of fisheries or individuals. Because reporting was not done separately for the Kodiak and Alaska Peninsula regions until after 1995, we grouped these areas into a single region. 

To examine the effects of hatchery production on stability, we used a hierarchical variance function regression model. Variance function models (or heteroscedastic regression models, [@smyth1989]) are regression models that also allow covariates for the residual variance component (similar to performing sequential regressions on the mean and residuals [@western2009]). We modeled the mean catch of each species in each region as an AR(1) process, $$E[{ Y }_{ s,f,t }]={ Y }_{ s,f,t-1 }+{ b }_{ s,f }{ X }_{ s,f,t }$$ where ${ Y }_{ s,f,t-1 }$ is the observed catch of species $s$ in region $f$ in the previous time step $t-1$, ${ b }_{ s,f }$ is an estimated coefficient relating hatchery influence to the mean catch, and ${ X }_{ s,f,t }$ is the change in proportion of hatchery contribution to the total catch for species *s* between times *t* and *t-1*. We used the difference in hatchery contribution, rather than raw values because the response variable was also first differenced. The hatchery-effect coefficients were modeled hierarchically, and we assumed that ${ b }_{ s,f }\sim N\left( { u }_{ b },{ \sigma  }_{ b } \right)$, where ${ u }_{ b }$ and ${ \sigma  }_{ b }$ represent the location and scale hyperparameters.

To incorporate potential hatchery effects in the variability of salmon catches, the second component of our model included a hierarchical model on the process variance terms, $$log\left( { \sigma  }_{ s,f,t } \right) ={ g  }_{ 0,s,f }+{ g  }_{ 1,s,f }{ X }_{ s,f,t }$$ where ${ g  }_{ 0,s,f }$ represents an estimated intercept unique to each region and species, and ${ g  }_{ 1,s,f }$ represents a region- and species-specific slope. The covariate ${ X }_{ s,f,t }$ is identical to that used in the mean model. We included the intercepts ${ g  }_{ 0,s,f }$ as fixed effects (representing differences by species) and again modeled the hatchery effect as hierarchical, ${ g }_{ 1,s,f }\sim N\left( { u }_{ g },{ \sigma  }_{ g } \right)$. The observed data were log-transformed and linked to the predicted mean and standard deviation with a normal likelihood, $ln\left( { Y }_{ s,f,t } \right) \sim N\left( E\left[ ln\left( { Y }_{ s,f,t } \right)  \right] ,{ \sigma  }_{ s,f,t } \right)$. 
<!-- Sean: is there a reason why we are modeling the slope hierarchically but not the intercept? -->

We focused our inference on the slopes of the fraction of hatchery contribution to the mean and standard deviation of estimated annual catches, ${ b }_{ s,f }$ and ${ g }_{ 1,s,f }$. To allow for comparison across regions and scales of data, we converted these estimates to effect sizes, by calculating ${ \kappa  }_{ s }=ln\left( \frac { { g }_{ 0,s }+{ 0.2 \cdot g }_{ 1,s } }{ { g }_{ 0,s } }  \right)$. The term ${ \kappa  }_{ s }$ then represents the approximate percent change in the standard deviation resulting from a 20% increase in the hatchery contribution. 95% credible intervals were generated by repeating this calculation for each MCMC draw, and taking the quantiles of the resulting distribution. 

### Have effects of diversification changed over time for individual salmon fishers?

Because we are focused on single permit fisheries, we applied a simplified version of the CFEC data filtering steps described in [@anderson_benefits]. Individual trip-level catch and revenue data from 1975--2016 were aggregated to annual data for each fisher, and to clarify our comparison across fisheries we only included individual fishers who participated in a single fishery in a year (Table 1). To avoid complications in modeling individual switching permits, we only included pairs of years for a given person where the individual did not change permits between two years. @anderson_benefits implemented a hierarchical Bayesian time series model that incorporated group-level predictors and allowed individual covariates (diversity of catch, days fished) to simultaneously affect the mean and variance of revenue for individual fishers. This model also included random intercepts on the mean by fishery and year, allowing all permit holders in a given year to experience common fluctuations (external drivers including price changes, fluctuations in fish population abundance, or environmental disasters such as the Exxon Valdez oil spill). 

To address how benefits of diversification may have changed over time for salmon fisheries in Alaska, we extend the model of [@anderson_benefits] to include time-varying random effects in the slope coefficients of diversification. We define the variables $\Delta { S }_{ t }=\log\left( { S }_{ t }/{ S }_{ t-1 } \right)$ to represent the percent change in species diversity of the catch between years and $\Delta { D }_{ t }=\log\left( { D }_{ t }/{ D }_{ t-1 } \right)$ to represent the percent change in fishing effort (days fished) between years. Our model for the expected log revenue of individual *i* in year *t* is $$\widehat { \log\left( { R }_{ i,t } \right)  } ={ B }_{ 0,j,t }+{ B }_{ 1,j,t }\cdot \Delta S_{ i,t }+{ B }_{ 2,j,t }\cdot \left( \Delta S_{ i,t }\cdot { S }_{ i,t-1 } \right) +{ B }_{ 3,j }\cdot \Delta D_{ i,t }+\log\left( { R }_{ i,t-1 } \right), $$ where *j* subscripts the salmon permit (Table 1). We model the time-varying intercepts, specific to each permit, as random and exchangeable across years, ${ B }_{ 0,j,t }\sim \mathrm{Normal}\left( { u }_{ { B }_{ 0 } },{ \sigma  }_{ { B }_{ 0 } } \right)$. The term ${ B }_{ 1,j,t }$ represents the permit-level random effect of diversifying species. We also include the interaction terms $\Delta S_{ t }\cdot { S }_{ t-1 }$, which allow the effect of diversification to be dependent on the previous level of diversification. We assume this relationship is linear, and the coefficients ${ B }_{ 1,j,t }$ and ${ B }_{ 2,j,t }$ allow this to vary by permit and through time. The flexibility in these terms allows the benefit of increasing species diversity to be positive in some years (generalizing benefits revenue), negative in other years (specializing benefits revenue) and neutral in other years (revenue is independent of alterations to catch composition). We constrain the random effects associated with diversification to be modeled as autoregressive processes with shared variances across strategies, for example: ${ B }_{ 1,j,t }\sim \mathrm{Normal}\left( { B }_{ 1,j,t-1 },{ \sigma  }_{ { B }_{ 1 } } \right)$. As in  @anderson_benefits, we also allow the effect of changing effort (measured as percent change in days fished) ${ B }_{ 3,j }$ to vary by strategy, but we do not allow this effect to vary through time. Finally, the term $\log\left( { R }_{ i,t-1 } \right)$ is included as an offset.
<!-- Sean: Is B_3,j modeled hierarchically? 
<!-- Sean: Should there be a main effect for species diversity as well? Right now it's only in there as an interaction --> 
<!-- Sean: This section uses \mathrm{Normal} while the earlier section used N -->

Following @anderson_benefits, we also included the above covariates in the variance model. We assumed the residuals from the mean model described above to be normally distributed, $$\log\left( { R }_{ i,t } \right) \sim \mathrm{Normal}\left( \widehat { \log\left( { R }_{ i,t } \right)  } ,\widehat { { \sigma  }_{ i,t } }  \right).$$ While conventional hierarchical linear regression assumes variances to be constant or shared by grouping variables, we also included fixed and random covariates, making the model akin to variance function regression or stochastic volatility models [@smyth1989; @western2009]. We can express the log standard deviation as $$\widehat { \log\left( { \sigma  }_{ i,t } \right)  } ={ G }_{ 0,j }+{ G }_{ 1,j,t }\cdot \Delta S_{ i,t }+{ G }_{ 2,j,t }\cdot \left( \Delta S_{ i,t }\cdot { S }_{ i,t-1 } \right) +G_{ 3,j }\cdot \Delta D_{ i,t }$$. Unlike the linear model for the mean, an offset term is not included for the variance. Furthermore, we constrained the variance intercepts ${G}_{0,j}$ to be temporally constant by strategy, instead of the dynamic nature of the intercepts in the mean model. Like the mean model, the random effects were constrained to be autoregressive, ${ G }_{ 1,j,t }\sim \mathrm{Normal}\left( { G }_{ 1,j,t-1 },{ \sigma  }_{ { G }_{ 1 } } \right)$, and covariates associated with days fished and species diversity were included as predictors.
<!-- Sean: and modeled hierarchically? -->
<!-- Sean: the model in the last section didn't use a hat on the standard deviation term. We should probably pick one way to be consistent. -->

### Estimation  

Estimation for both sets of models was done in a Bayesian framework using R [@rcoreteam2016] and the package **rstan**, implementing Markov chain Monte Carlo (MCMC) using the No-U Turn Sampling (NUTS) algorithm in Stan [@hoffman2014; @standevelopmentteam2016; @standevelopmentteam2016a]. Code to replicate our analysis, including additional diagnostics plots, and additional models is available at [https://github.com/NCEAS/pfx-commercial-salmon].
[Eric will add more here]

## Results

Across species and regions we found no consistent support for the hypothesis that variability in salmon catches has been stabilized by increased hatchery production. Across fisheries in the four regions in our analysis, most estimates of hatchery production on changes in the mean total catch are near zero (Fig. 4). One exception is a negative estimated effect of hatcheries on Chinook catches in Southeast Alaska (reduced catches as the hatchery contribution increases). 95% credible intervals around these estimates are large however, and overlap zero.

Most estimates of hatchery effects on year-to-year variability are slightly positive (Fig. 4) indicating increased revenue variability with increased hatchery contribution. The strongest positive effects appear to be the contributions of hatchery pink and coho salmon to variability in catches, particularly in Prince William Sound.
<!-- Sean: I might be inclined to rotate the figure 90degrees. This would also give to write out the area of names if the axes are shared... up to you though -->

Our model of changing effects of diversification over time suggests that as diversity in these six fisheries have declined over time (Figs. A3-A4), higher revenue has been increasingly associated with increased specialization (Fig. 5). The negative estimated effects on mean revenue of increasing diversity implies that for the majority of these fisheries in most years, revenue increases when individuals specialize, rather than diversify. Though gillnet fisheries in Southeast Alaska and Prince William Sound have also had reduced benefits of diversifying, each fishery had several periods where it was more profitable to increase catch diversity (mid-1980s to early-1990s for Southeast Alaska, mid-1990s for Prince William Sound). With the exception of the Southeast Alaska seine fishery (S01A) in recent years, the negative trends in these estimated effects for most fisheries suggest that the benefits of specializing on revenue have also increased over time.
<!-- Sean: can we add "on mean revenue" to the y axis label? -->

Our results also showed contrasts in variability between seine and gillnet fisheries (Fig. A10), with individuals in seine fisheries experiencing higher annual variability in revenue. 
<!-- Sean: I don't think this figure reference is correct, but I'm not sure what the correct one is -->
These results are expected, because when individuals are aggregated, seine fisheres are generally higher on axes of risk and return (CV of annual revenue, mean annual revenue; Fig. 2). Though the catch composition of each of these fisheries has fluctuated through time, in areas where seine and gillnet fisheries exist (Prince William Sound, Southeast Alaska), effective catch diversity is slightly higher in gillnet fisheries (Figs A3-A4).  

We found little support for increasing catch diversity reducing variability in revenue for most fisheries (Fig. A9). For seine fisheries in Southeast Alaska and Prince William Sound, there have been periods over the last several decades where diversification has increased variability, but this effect has been strongest over the most recent decade (Fig. A9). Perhaps the only example of a fishery where individuals have seen reduced variability from increasing catch diversity is the Kodiak seine fishery (this effect is strongest in the 1990s and last 5 years). While these effects of diversifying are near zero for most fisheries and do not exhibit a long-term trend, an exception is the Prince William Sound seine fishery, which appears to have increasing risk associated with diversifying over the time series (Fig. A9).
<!-- Sean: I think you mean the Prince William Sound gillnet fishery? Or are you talking about the last ten years in that seine fishery? -->

## Discussion

Understanding the mechanisms responsible for trends or variability in the revenue of individuals whose incomes are dependent on natural resources is important for coupled social-ecological systems, because their income variability is typically greater than that of the larger population [@mishra2002; @sethi2012]. Unlike terrestrial farmers, commercial fishers are often constrained by regulations that can limit the number of individuals who can participate, where fishing occurs, what type of gear is used, or when fishing occurs. Individuals participating in many of the commercial salmon fisheries in Alaska may have the option of increasing the diversity of their catches. Examining long-term trends in catch diversity for seine and gillnet fisheries in our analysis illustrates that most fisheries have become less diverse over time. In recent years, catches from several of these fisheries have been dominated by single species (sockeye salmon in the Prince William Sound gillnet fishery, pink salmon in the Prince William Sound seine fishery, chum salmon in the Southeast Alaska gillnet fishery; Figs. A3-A4).

Like in other commercial fisheries, the ability of salmon fishers to diversify within the constraints of their permits may be largely driven by factors beyond their control. Options for catching other species may include fishing in different months or different regions. For example, individuals participating in the Prince William Sound seine fishery may fish earlier in the year to target chum salmon. Incentives to diversify are complex, and include a suite of external economic factors: competition from foreign markets, prices from processors, fuel costs, and marketing (e.g. increased marketing of Copper River sockeye salmon beginning in the early 1980s) [@knapp_trends]. A potential driver unique to Alaska salmon fisheries is the potential impacts of hatchery salmon. Increased hatchery production may alter the species composition that individual fishers encounter, as well as the prices set by processors.   

Results from our variance function model of individual revenues over the period 1975--2016 suggest that there have been long-term increases in the benefits of individual fishers specializing (expected revenue increases when catch diversity decreases; Fig. 5). For most of the time series, the impacts of changes to catch diversity on variability in year-to-year revenue are less clear. A counter-intuitive result is that since the mid-2000s, fisheries in Prince William Sound and seine fisheries in Southeast Alaska have had an estimated increase in revenue variability associated with diversification. Some of this relationship may be spurious, in that individuals who have large reductions in catch diversity may harvest less (Fig. A11). But another driver may be increased consolidation from processors. Prices of all salmon have generally increased since the early 2000s, with some of the largest changes being in pink and chum salmon prices. In areas with high pink or chum salmon runs, the benefits of diversification may have been greatest when these species had low returns. For pink salmon returns with strong 2-year oscillations for example, this would correspond to even versus odd years.

An additional potential impact of increased hatchery production may be changes in the variability of catches or revenues, to fisheries or individuals. Across multiple regions in Alaska, we found little support for catches becoming more stable as hatchery programs have increased. One example of a positive correlation between the hatchery contribution to harvest and variability is pink salmon in Prince William Sound (Fig. 4). Our model describing the revenues of individual fishers also suggests that inividuals in the Prince William Sound seine fishery have higher year to year variability relative to other fisheries (Fig. A10), with year to year changes being correlated with fluctuations in pink salmon returns (Fig. A12).
<!-- Sean: Again I think Figure A10 has changed? -->

The increased specialization of Alaska fisheries has been highlighted in several recent analyses [@kasperski2013; @anderson_benefits; @sethi2012], and our analysis extends this work to show similar trends within individual Alaskan salmon fisheries. In terrestrial agriculture, there are multiple examples of year-to-year income variability being stabilized by diversification [@difalco2003], but these incentives become more complex at larger scales. Crop diversification in developed countries is shaped by a number of drivers including changing national policies, technology, and increased demand from other parts of the world (e.g. U.S. production of soybeans for Asian countries) [@bradshaw2004; @aguilar2015]. Shifts in terrestrial agriculture from a diverse mix of low- and high-value crops to focusing on high-volume low-value crops (such as soybeans or cereals) may have parallels for Alaskan salmon fisheries --- particularly those fisheries that have more recently targeted low-value species with rapid life histories (pink, chum salmon). 

Increasing trends toward specialization in Alaska salmon fisheries may be acceptable for fishers if individuals are willing to accept the additional risk that may accompany larger revenues, particularly when prices and abundances are high. Variability in the revenues that individuals or communities experience is product of many complex drivers, including management, market forces, and environmental variation. While reducing risks to individual fisher revenues is not something that can currently be managed for, understanding patterns of variability that individuals experience is essential for quantifying changing revenue patterns at higher levels of fisheries and coastal communities, and protecting individuals from future economic shocks. 

\break  

<!-- TODO Sean: we can make these share a common color legend, either by arranging the data and using facets, or using the trick over in the pfx-commercial repository that we used and some of those figures. The code is also on the ggplot wiki. -->  
```{r fig1, echo=FALSE, fig.pos="placeHere", fig.cap="Trends in participation, landed catch, mean annual revenue, and effective species diversity for eight selected Alaska salmon fisheries. "}
# trends in participation, 
cfec_all = readRDS("../data-generated/salmon_data_for_paper.rds")
people = group_by(cfec_all, p_fshy, year) %>% 
  summarize(n = length(unique(p_holder))) %>% 
  filter(substr(p_fshy,1,1)=="S")
people$p_fshy = paste0(substr(people$p_fshy,1,1), substr(people$p_fshy,3,5))
names(people)[which(names(people)=="p_fshy")]="Permit"

people2 = people[people$Permit%in%c("S01K","S01M","S01E","S01A","S03A","S03E","S03T","S05B"),]
people2$Permit[which(people2$Permit=="S01K")] = "KO-seine"
people2$Permit[which(people2$Permit=="S01M")] = "AP-seine"
people2$Permit[which(people2$Permit=="S01E")] = "PWS-seine"
people2$Permit[which(people2$Permit=="S01A")] = "SE-seine"
people2$Permit[which(people2$Permit=="S03A")] = "SE-drift"
people2$Permit[which(people2$Permit=="S03E")] = "PWS-drift"
people2$Permit[which(people2$Permit=="S03T")] = "BB-drift"
people2$Permit[which(people2$Permit=="S05B")] = "State-troll"

g1 = ggplot(people2, aes(year, log10(n), color = Permit)) + geom_line() + ylab("Log10 unique people") + xlab("Year") + theme_bw() + theme(panel.border = element_blank(), panel.grid.major = element_blank(), panel.grid.minor = element_blank(), axis.line = element_line(colour = "black"))

# trends in landed weight - metric tons
#weight_by_species = group_by(cfec_all[cfec_all$p_fshy %in% c("S 01A", "S 01E", "S 01K", "S 01M", "S 03A", "S 03E") & cfec_all$spec %in% c("CHNK","COHO","CHUM","PINK","SOCK"), ], p_fshy, year, spec) %>% 
#summarize(w = sum(g_pounds,na.rm=T) * 0.000453592) %>% 
#filter(substr(p_fshy,1,1)=="S")
#saveRDS(weight_by_species, "../../portfolio/data-generated/weight_data_by_species_fishery.rds")
#weight_by_species_people = left_join(weight_by_species, people)
#saveRDS(weight_by_species_people, "../../portfolio/data-generated/weight_data_by_species_people.rds")

# also calculate for each person, the number of unique permits held per year
#people1 = group_by(cfec_all, year, p_holder) %>% 
#  summarize(n = length(unique(p_fshy))) %>% 
#  filter(n==1)
#people1 = left_join(people1, cfec_all) %>% 
#  filter(p_fshy %in% c("S 01A", "S 01E", "S 01K", "S 01M", "S 03A", "S 03E")) %>% 
#  filter(spec %in% c("CHNK","COHO","PINK","SOCK","CHUM"))
#people1 = group_by(people1, p_holder, year, p_fshy, spec) %>% 
#  summarize(w = sum(g_earn)) %>% 
#  group_by(p_fshy, year, spec) %>% 
#  summarize(w = mean(w, na.rm=T))
#saveRDS(people1, "../../salmon/data-generated/weight_data_by_species_people2.rds")

# trends in landed weight - metric tons
weight = group_by(cfec_all, p_fshy, year) %>% 
  summarize(w = sum(g_pounds,na.rm=T) * 0.000453592) %>% 
  filter(substr(p_fshy,1,1)=="S")
weight$p_fshy = paste0(substr(weight$p_fshy,1,1), substr(weight$p_fshy,3,5))
names(weight)[which(names(weight)=="p_fshy")]="Permit"

weight = left_join(weight, people)

weight2 = weight[weight$Permit%in%c("S01K","S01M","S01E","S01A","S03A","S03E","S03T","S05B"),]
weight2$Permit[which(weight2$Permit=="S01K")] = "KO-seine"
weight2$Permit[which(weight2$Permit=="S01M")] = "AP-seine"
weight2$Permit[which(weight2$Permit=="S01E")] = "PWS-seine"
weight2$Permit[which(weight2$Permit=="S01A")] = "SE-seine"
weight2$Permit[which(weight2$Permit=="S03A")] = "SE-drift"
weight2$Permit[which(weight2$Permit=="S03E")] = "PWS-drift"
weight2$Permit[which(weight2$Permit=="S03T")] = "BB-drift"
weight2$Permit[which(weight2$Permit=="S05B")] = "State-troll"

g2 = ggplot(weight2, aes(year, log10(w/n), color = Permit)) + geom_line() + ylab("Log10 tons per person") + xlab("Year") + theme_bw() + theme(panel.border = element_blank(), panel.grid.major = element_blank(), panel.grid.minor = element_blank(), axis.line = element_line(colour = "black"))

# trends in revenue
dat.annual = readRDS(file="../data-generated/salmon-annual-for-modeling.rds")
dat.annual = group_by(dat.annual[which(dat.annual$strategy_permit %in% c("S01A", "S01E", "S01K", "S01M", "S03A", "S03E", "S03T", "S05B")),], year, strategy_permit) %>% 
  summarize(meanrev = mean(revenue), meandiv = mean(specDiv))
names(dat.annual)[which(names(dat.annual)=="strategy_permit")]="Permit"
dat.annual = left_join(dat.annual, weight)

dat.annual2 = dat.annual[dat.annual$Permit%in%c("S01K","S01M","S01E","S01A","S03A","S03E","S03T","S05B"),]
dat.annual2$Permit[which(dat.annual2$Permit=="S01K")] = "KO-seine"
dat.annual2$Permit[which(dat.annual2$Permit=="S01M")] = "AP-seine"
dat.annual2$Permit[which(dat.annual2$Permit=="S01E")] = "PWS-seine"
dat.annual2$Permit[which(dat.annual2$Permit=="S01A")] = "SE-seine"
dat.annual2$Permit[which(dat.annual2$Permit=="S03A")] = "SE-drift"
dat.annual2$Permit[which(dat.annual2$Permit=="S03E")] = "PWS-drift"
dat.annual2$Permit[which(dat.annual2$Permit=="S03T")] = "BB-drift"
dat.annual2$Permit[which(dat.annual2$Permit=="S05B")] = "State-troll"

g3 = ggplot(dat.annual2, aes(year, log10(meanrev), color = Permit)) + geom_line() + ylab("Log10 revenue per person") + xlab("Year") + theme_bw() + theme(panel.border = element_blank(), panel.grid.major = element_blank(), panel.grid.minor = element_blank(), axis.line = element_line(colour = "black"))

g4 = ggplot(dat.annual2, aes(year, meandiv, color = Permit)) + geom_line() + ylab("Species diversity") + xlab("Year") + theme_bw() + theme(panel.border = element_blank(), panel.grid.major = element_blank(), panel.grid.minor = element_blank(), axis.line = element_line(colour = "black"))

gridExtra::grid.arrange(g1,g2,g3, g4, ncol=2)

```
  
\break  

<!-- TODO Sean: I guess we need to make sure we defined these regions either here or in a table -->
```{r fig2, echo=FALSE, fig.pos="placeHere", fig.cap="CV and mean annual revenue by salmon permit, 1975--2016. Effective species diversity of catch is shown by circle area (effective species diversity = 1 / Simpson's diversity), and fishing gear type are shown with color shading. Labels indicate regions.", warning=FALSE, message=FALSE}
# dat.annual = readRDS(file="../data-generated/salmon-annual-for-modeling.rds")
# 
# people = group_by(cfec_all, p_fshy, year) %>% 
#   summarize(n = length(unique(p_holder))) %>% 
#   group_by(p_fshy) %>% summarize(n = mean(n,na.rm=T))
# names(people)[which(names(people)=="p_fshy")] = "strategy_permit"
# people$strategy_permit = paste0(substr(people$strategy_permit,1,1), substr(people$strategy_permit,3,5))
# 
# records_s03h = which((dat.annual$strategy_permit == "S03H" & dat.annual$year %in% c(1989,1990) | dat.annual$strategy_permit == "S04X"))
# 
# dat.annual = filter(dat.annual[-records_s03h,], npermit==1 & substr(strategy_permit,1,1)=="S") %>%
#   group_by(strategy_permit) %>%
#   mutate(nPeople = length(unique(p_holder))) %>%
#   filter(nPeople > 200) %>%
#   dplyr::select(-nPeople) %>%
#   group_by(strategy_permit, year) %>%
#   summarize(meanrev = mean(revenue), meandiv = mean(specDiv)) %>%
#   arrange(strategy_permit, year) %>%
#   group_by(strategy_permit) %>%
#   summarize(mean_rev = mean(meanrev,na.rm=T), cv_rev = sd(diff(log(meanrev)),na.rm=T),
#     diversity = mean(meandiv,na.rm=T)) %>% as.data.frame
# 
# dat.annual = left_join(dat.annual, people)
# dat.annual$gear = substr(dat.annual$strategy_permit,2,3)
# dat.annual$gear[which(dat.annual$gear=="01")]="Purse seine"
# dat.annual$gear[which(dat.annual$gear=="03")]="Drift gillnet"
# dat.annual$gear[which(dat.annual$gear=="04")]="Set gillnet"
# dat.annual$gear[which(dat.annual$gear%in%c("05"))]="Hand troll"
# dat.annual$gear[which(dat.annual$gear=="15")]="Power troll"
# 
# dat.annual$price = NA
# dat.annual$price[dat.annual$strategy_permit=="S01A"]=250000
# dat.annual$price[dat.annual$strategy_permit=="S01E"]=186700
# dat.annual$price[dat.annual$strategy_permit=="S01H"]=84800
# dat.annual$price[dat.annual$strategy_permit=="S01K"]=40000
# dat.annual$price[dat.annual$strategy_permit=="S01L"]=227500
# dat.annual$price[dat.annual$strategy_permit=="S01M"]=56900
# 
# dat.annual$price[dat.annual$strategy_permit=="S03A"]=88900
# dat.annual$price[dat.annual$strategy_permit=="S03E"]=224200
# dat.annual$price[dat.annual$strategy_permit=="S03H"]=63500
# dat.annual$price[dat.annual$strategy_permit=="S03M"]=119500
# dat.annual$price[dat.annual$strategy_permit=="S03T"]=148200
# dat.annual$price[dat.annual$strategy_permit=="S03W"]=NA
# 
# dat.annual$price[dat.annual$strategy_permit=="S04D"]=88900
# dat.annual$price[dat.annual$strategy_permit=="S04H"]=15300
# dat.annual$price[dat.annual$strategy_permit=="S04K"]=77000
# dat.annual$price[dat.annual$strategy_permit=="S04M"]=55900
# dat.annual$price[dat.annual$strategy_permit=="S04T"]=38500
# dat.annual$price[dat.annual$strategy_permit=="S04W"]=7300
# dat.annual$price[dat.annual$strategy_permit=="S04X"]=5400
# dat.annual$price[dat.annual$strategy_permit=="S04Y"]=9900
# dat.annual$price[dat.annual$strategy_permit=="S04Z"]=11100
# 
# dat.annual$price[dat.annual$strategy_permit=="S05B"]=11000
# dat.annual$price[dat.annual$strategy_permit=="S15B"]=38300
# 
# g1 = ggplot(dat.annual, aes(x=mean_rev, y=cv_rev, label = dat.annual$strategy_permit)) + geom_point(alpha=0.7, aes(col=gear,size=diversity)) + scale_size(range = c(0, 20)) + geom_text_repel() + ylab("CV annual revenue") + xlab("Mean revenue (dollars)") + theme_bw() + theme(panel.border = element_blank(), panel.grid.major = element_blank(),
# panel.grid.minor = element_blank(), axis.line = element_line(colour = "black"))
# print(g1)
#pdf("Figure_01.pdf")
#print(g1)
#dev.off()

dat.annual <- read.table("../data-generated/bubble_plot_data_fig2.csv", stringsAsFactors = FALSE, header = TRUE)

dat.annual <- mutate(dat.annual,
  gear = factor(gear, levels = c("Drift gillnet", "Set gillnet", "Hand troll",
    "Power troll", "Purse seine")))

l <- tibble::tribble(~let, ~label,
  "H", "CI",
  "E", "PWS",
  "L", "CH",
  "K", "KO",
  "M", "AP",
  "T", "BB",
  "A", "SE",
  "B", "State",
  "Z", "NS",
  "W", "KU",
  "D", "YAK",
  "Y", "YUK")

dat.annual <- mutate(dat.annual,
  let = sub("S[0-9]+([A-Z])", "\\1", dat.annual$strategy_permit)) %>%
  left_join(l) %>%
  filter(strategy_permit != "S04Y")

g <- ggplot(dat.annual,
  aes(x = mean_rev/1e3, y = cv_rev,
    label = label)) +
  geom_point(alpha = 0.5, aes(fill = gear, size = diversity), pch = 21,
    colour = "grey20") +
  scale_size(range = c(1.5, 15), breaks = seq(1.2, 2.4, 0.4)) +
  guides(fill = guide_legend(override.aes = list(size = 4, alpha = 0.7), order = 1)) +
  geom_text_repel(size = 2.6, colour = "grey20",
    alpha = 1, segment.color = "grey70",
    point.padding = unit(0, "lines"), max.iter = 1e4, segment.size = 0.3) +
  scale_fill_brewer(palette = "Set3") +
  ylab("CV annual revenue") + xlab("Mean revenue ($1000)") +
  labs(fill = "Gear", size = "Diversity") +
  scale_y_continuous(breaks = seq(0.2, 1, 0.2)) +
  theme_sleek() #+
  # scale_x_log10()
print(g)
```

  
\break  
  
```{r fig3, echo=FALSE, fig.pos="placeHere", fig.cap="Harvest of hatchery-produced salmon through time by species and area. Shown are the numbers of hatchery fish caught by fisheries (top row), and the hatchery contribution of each species to total catch (bottom row). Areas represents combined Kodiak and Alaska Peninsula ('KO - AP'), Southeast ('SE') and Prince William Sound ('PWS'). "}

seak_hatch = read.csv("../data-generated/seak_hatcheryHarvest.csv")
pws_hatch = read.csv("../data-generated/pws_hatcheryHarvest.csv")
kodiak_hatch = read.csv("../data-generated/kodiak_hatcheryHarvest.csv")

seak_hatch = melt(seak_hatch, id.vars = c("Year"))
pws_hatch = melt(pws_hatch, id.vars = c("Year"))
kodiak_hatch = melt(kodiak_hatch, id.vars = c("Year"))

seak_hatch$region = "SE"
pws_hatch$region = "PWS"
kodiak_hatch$region = "KO - AP"

seak_hatch$value[is.na(seak_hatch$value)] = 0
pws_hatch$value[is.na(pws_hatch$value)] = 0
kodiak_hatch$value[is.na(kodiak_hatch$value)] = 0

dat = bind_rows(seak_hatch, pws_hatch)
dat = bind_rows(dat, kodiak_hatch)

names(dat)[which(names(dat)=="variable")]="species"
dat$value = dat$value / 1000000

# chinook chum coho pink sock
cbPalette <- c("#009E73", "#4B2E83", "#999999", "#CC79A7", "#D55E00")

dat$col = as.numeric(as.factor(dat$species))
g1 = ggplot(dat, aes(Year, value)) +
  geom_area(aes(fill = species), position = "stack") +
  xlab("Year") + ylab("Hatchery harvest (millions)") +
  scale_fill_manual(values = c('Chinook'=cbPalette[1], 'Chum'=cbPalette[2], 
    'Coho'=cbPalette[3], 'Pink'=cbPalette[4], 'Sockeye'=cbPalette[5]), name="Species",
    labels =c("Chinook","Sockeye","Coho","Pink","Chum")) + 
  facet_wrap(~region, scale="free_y") + theme_bw() + theme(panel.border = element_blank(), panel.grid.major = element_blank(), panel.grid.minor = element_blank(), axis.line = element_line(colour = "black"))

# bring in total harvest data (hatchery + wild)
hatch = read.csv("../data-generated/commonPropertyCommercialCatch.csv",
  stringsAsFactors = FALSE)

kodap1 = hatch[which(hatch$Region%in%c("Kodiak") & hatch$Year <= 1995),]
kodap2 = hatch[which(hatch$Region%in%c("AP", "Kodiak") & hatch$Year > 1995),]
kodap2 = dplyr::group_by(kodap2, Year) %>% 
  summarize(Chinook_harvest = sum(Chinook_harvest),
    Sockeye_harvest = sum(Sockeye_harvest),
    Coho_harvest = sum(Coho_harvest),
    Pink_harvest = sum(Pink_harvest),
    Chum_harvest = sum(Chum_harvest),
    Region = Region[1],
    Source = Source[1],
    ReportNumber = ReportNumber[1],
    Chinook_enhanced = sum(Chinook_enhanced),
    Sockeye_enhanced = sum(Sockeye_enhanced),
    Coho_enhanced = sum(Coho_enhanced),
    Pink_enhanced = sum(Pink_enhanced),
    Chum_enhanced = sum(Chum_enhanced))
kodap = rbind(as.data.frame(kodap1), as.data.frame(kodap2))
kodap$Region = as.character(kodap$Region)
kodap$Source = as.character(kodap$Source)
kodap$ReportNumber = as.character(kodap$ReportNumber)

hatch = rbind(hatch[which(hatch$Region %in% c("PWS","Southeast")),], kodap)

hatch$pChinook = hatch$Chinook_enhanced/hatch$Chinook_harvest
hatch$pSockeye = hatch$Sockeye_enhanced/hatch$Sockeye_harvest
hatch$pCoho = hatch$Coho_enhanced/hatch$Coho_harvest
hatch$pPink = hatch$Pink_enhanced/hatch$Pink_harvest
hatch$pChum = hatch$Chum_enhanced/hatch$Chum_harvest

hatch = hatch[,c("Year","pChinook","pSockeye","pCoho","pPink","pChum","Region")]
hatch = dplyr::rename(hatch, Chinook=pChinook,Sockeye=pSockeye, Coho=pCoho, Pink=pPink, Chum=pChum)
hatch$Region = as.character(hatch$Region)
hatch$Region[which(hatch$Region=="PWS")] = "PWS"
hatch$Region[which(hatch$Region=="Kodiak")] = "KO - AP"
hatch$Region[which(hatch$Region=="Southeast")] = "SE"
hatch = melt(hatch, id.vars = c("Year","Region"))
names(hatch)[which(names(hatch)=="variable")]="Species"

g2 = ggplot(hatch, aes(Year, value, color=Species)) + 
  geom_line() + facet_wrap(~Region) + 
  xlab("Year") + ylab("Hatchery fraction of total catch") + 
  scale_color_manual(values = c('Chinook'=cbPalette[1], 'Chum'=cbPalette[2], 
    'Coho'=cbPalette[3], 'Pink'=cbPalette[4], 'Sockeye'=cbPalette[5]), name="Species",
    labels =c("Chinook","Sockeye","Coho","Pink","Chum")) + theme_bw() + theme(panel.border = element_blank(), panel.grid.major = element_blank(), panel.grid.minor = element_blank(), axis.line = element_line(colour = "black"))

gridExtra::grid.arrange(g1, g2)

# join datasets together for modeling
names(dat) = tolower(names(dat))
names(hatch) = tolower(names(hatch))
names(dat)[which(names(dat)=="value")] = "hatchery_harvest_millions"
names(hatch)[which(names(hatch)=="value")] = "percent_hatchery"
dat = left_join(dat, hatch)
dat$total_harvest = dat$hatchery_harvest_millions / (dat$percent_hatchery/100)
saveRDS(dat, file="../data-generated/hatchery_harvest_millions.rds")
```
  
\break  

```{r fig4, echo=FALSE, fig.pos="placeHere", fig.cap="Effects of the fraction of hatchery fish on (1) mean annual revenue, and (2) standard deviation of annual revenue, for three areas ('KO' = Kodiak, 'PWS' = Prince William Sound, 'SE' = Southeast). Effect sizes are presented as the percentage change from an increase from 0% hatchery fish to 20% hatchery fish. Dots represent mean estimates and error bars represent +/- 1 standard error."}

df = readRDS(file=paste0("../data-generated/","region","_df.rds"))
cbPalette <- c("#009E73", "#4B2E83", "#999999", "#CC79A7", "#D55E00")

df$fishery[which(df$fishery=="Prince William Sound")] = "PWS"
df$fishery[which(df$fishery=="SEAK")] = "SE"
df$fishery[which(df$fishery=="Kodiak")] = "KO"

p1 = ggplot(df, aes(x=fishery, y=bestimate, group=species, color=species)) +
  geom_point(position=position_dodge(0.5), alpha = 0.5, size=3) +
  ylab("Effect size (mean)") +
  xlab("") +
  geom_errorbar(aes(ymin=bestimate-bsd, ymax=bestimate+bsd),
    position=position_dodge(0.5), alpha=0.5) +
  scale_color_manual(values = c('Chinook'=cbPalette[1], 'Chum'=cbPalette[2],
    'Coho'=cbPalette[3], 'Pink'=cbPalette[4], 'Sockeye'=cbPalette[5]), name="Species",
    labels =c("Chinook","Sockeye","Coho","Pink","Chum"))+
  geom_hline(aes(yintercept=0), linetype = 2) +
  theme_bw() +
  theme(panel.border = element_blank(), panel.grid.major = element_blank(),
    panel.grid.minor = element_blank(), axis.line = element_line(colour = "black")) + coord_flip() + theme(legend.position="none") + ylim(c(-0.2,0.27))

p2 = ggplot(df, aes(x=fishery, y=estimate, group=species, color=species)) +
  geom_point(position=position_dodge(0.5), alpha = 0.5, size=3) +
  ylab("Effect size (sd)") +
  xlab("") +
  geom_errorbar(aes(ymin=estimate-sd, ymax=estimate+sd),
    position=position_dodge(0.5), alpha=0.5) +
  scale_color_manual(values = c('Chinook'=cbPalette[1], 'Chum'=cbPalette[2],
    'Coho'=cbPalette[3], 'Pink'=cbPalette[4], 'Sockeye'=cbPalette[5]), name="Species",
    labels =c("Chinook","Sockeye","Coho","Pink","Chum"))+
  geom_hline(aes(yintercept=0), linetype = 2) +
  theme_bw() +
  theme(panel.border = element_blank(), panel.grid.major = element_blank(),
    panel.grid.minor = element_blank(), axis.line = element_line(colour = "black")) + coord_flip() + ylim(c(-0.2,0.27))

plot_grid(p1, p2, align = "h", nrow = 1, rel_widths = c(0.43, 0.57))
#gridExtra::grid.arrange(p1, p2, nrow=1)
```

\break  
  
  
```{r fig5, fig.pos="placeHere", fig.cap="Time-varying effects of increasing the effective diversity (1/Simpson's diversity) of catch from 1 to 2 species (presented as log ratio). There is an increasingly negative effect of diversification on mean revenue for individuals in most fisheries.", echo=FALSE}
# make yearpermit df
diffdat = readRDS(file="../data-generated/salmon.rds")
years = seq(min(diffdat$year), max(diffdat$year))
permits = levels(as.factor(diffdat$permit))
# note that we have to use factor() here instead of unique() because
# that's the same as the ordering in the estimation code
yearpermit = data.frame("yrpermit"=levels(as.factor(diffdat$year_permit)))
yearpermit$year = as.numeric(substr(yearpermit$yrpermit,1,4))
yearpermit$permit = substr(yearpermit$yrpermit,6,9)

# grab original data to look at permit names
diffdat = readRDS(file="../data-generated/salmon-diff-for-modeling.rds")
years = seq(min(diffdat$year), max(diffdat$year)) 
#permits = levels(as.factor(diffdat$permit))

yearpermitold=yearpermit
load("../analysis/model-linear.Rdata")
yearpermit=yearpermitold

est = extract(mod, permute="TRUE")

# start with making time series of estimates on mean
# challenge is that they're time varying quadratic functions
# do facet_wrap of estimates by year

# effect of adding more 1 species from 1. specdiv.prev = 1

specdiv.prev = seq(1, 5, by=0.1)
specdiv = specdiv.prev + 1 # always add 1 more in these comparisons
x1 = log(specdiv/specdiv.prev)
x2 = log(specdiv/specdiv.prev) * specdiv.prev
x3 = log(specdiv/specdiv.prev) * specdiv.prev^2

df = expand.grid("year"=1:length(years), "diversity" = seq(1,length(x1)), "permit"=1:6)
df$permits = permits[df$permit]
df$years = years[df$year]
df$x = specdiv.prev[df$diversity]
df$pred = 0
df$low = 0
df$high = 0
b0_indx = match(paste(as.character(df$years), as.character(df$permits)), as.character(yearpermit$yrpermit)) 
for(i in 1:nrow(df)) {
  #tmp = est$b0_str_yr[,b0_indx[i]] + 
  tmp = 
    x1[df$diversity[i]] * (est$b_1[,df$year[i], df$permit[i]])# +
    #x2[df$diversity[i]] * (est$b_2[,df$year[i], df$permit[i]]+est$b2_str_yr_mu)# +
    #x3[df$diversity[i]] * (est$b_3[,df$year[i], df$permit[i]]+est$b3_str_yr_mu)
  df$pred[i] = mean(tmp)
  df$low[i] = quantile(tmp,0.025)
  df$high[i] = quantile(tmp,0.975)
}

df$permits[which(df$permits=="S01A")] = "SE-seine"
df$permits[which(df$permits=="S01E")] = "PWS-seine"
df$permits[which(df$permits=="S01K")] = "KO-seine"
df$permits[which(df$permits=="S01M")] = "AP-seine"
df$permits[which(df$permits=="S03A")] = "SE-drift"
df$permits[which(df$permits=="S03E")] = "PWS-drift"

ggplot(df[df$diversity==1,], aes(x=years,y=pred,group=permits)) +
  geom_ribbon(aes(ymin=low,ymax=high), fill="blue",alpha=0.4) +
  geom_line(col="blue") + 
  facet_wrap(~permits) + xlab("Year") + ylab("Benefit of catch diversity increasing from 1 to 2") + geom_hline(yintercept=0, color="red", linetype = 2, alpha = 0.3) + theme_bw() + theme(panel.border = element_blank(), panel.grid.major = element_blank(), panel.grid.minor = element_blank(), axis.line = element_line(colour = "black"))

```

\break 
\break  
  
# References
