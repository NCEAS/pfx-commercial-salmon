---
title: Effects of increased specialization and hatchery production on revenue variability
  for individual Alaskan salmon fishers
author: "Eric, Sean, Ole, Rich, Jordan, Jen, Anne, Alan, Milo, Ben"
date: ''
output:
  word_document: default
  pdf_document:
    fig_caption: yes
  html_document: default
bibliography: CatchPortfolios_salmon.bib
---

```{r setup, include=FALSE, echo=FALSE}
knitr::opts_chunk$set(echo = TRUE, tidy=FALSE, tidy.opts=list(width.cutoff=60), warning = FALSE, message = FALSE)
library(knitr)
library(tidyverse)
library(ggsidekick)
library(ggrepel)
library(reshape2)
library(date)
library(mgcv)
library(gridExtra)
library(zoo)
library(rstan)
library(ggrepel)
library(cowplot)
modelname = "model-linear-iid" # model-linear-nointeractions
```

## Abstract
\setlength\parindent{24pt}

On a large scale, individual commercial fishers may experience positive outcomes from diversifying their catches; benefits may include reduced year-to-year variability in annual revenue or increases in average revenue. Fishers can increase the species diversity of their catch by owning fishing permits that allow multiple species to be targeted, or by owning multiple permits. Factors may disincentivize or prohibit individuals from holding multiple permits. Thus, individuals holding a single permit may only be able to increase species diversity within the confines of their permit (e.g., by fishing longer or over a broader spatial area). Using a 41-year dataset of individual salmon fishers in Alaska, we develop new models for understanding how the effects of diversification on revenue have changed through time. Applying these models to six salmon fisheries that encompass a broad geographic range and a variety of harvesting methods and dominant species, we find that the majority of these fisheries have experienced reduced diversity in catches through time, and increasing benefits of specialization on mean individual revenues. One of the mechanisms that has been hypothesized to reduce catch variability in Alaska has been large-scale hatchery production; however, our results across fisheries suggest that there is little change in variability, either positive or negative, as a result of increased hatchery influence. Individuals participating in fisheries with high contributions of hatchery pink salmon have the highest variability in year to year revenue, suggesting that risk may be partially determined by life history characteristics of species targeted.
  
## Introduction

[broader paragraph on diversification with extensions -- somewhat depends on journal, ]

Previous analyses have largely focused on patterns of diversification across ecosystems and the economic benefits of adopting more or less diverse fishing strategies [@kasperski2013; @anderson_benefits]. Fisheries in Alaska have been studied extensively, because they are one of the most productive seafood regions in the world (both by landed weight, and revenue [@officeofscienceandtechnology2016; @fissel2016]) and they allow individuals to adopt a wide range of fishing strategies. [@anderson_benefits] defined fishing strategies as a permit or collection of permits held by single individuals. Buying new permits allows individuals to fish in more regions or to target additional species. Some of these permits in Alaskan waters allow only one species to be targeted (e.g. sablefish, halibut, herring, crab, shellfish, and sea cucumber), while others allow for multiple species (federally managed groundfish fisheries, state managed salmon fisheries). 
  
Understanding the effects of species diversification for individuals participating in salmon fisheries is particularly important because the proportion of salmon specialists, defined as individuals whose fishing revenue comes from a single salmon permit, have increased over the last 30 years, and annual revenue from these salmon specialists has recently exceeded that of all other fisheries combined [@anderson_benefits]. As in terrestrial agriculture [@purdy1997], fishing diversification may affect the mean or variance of revenue, or may affect neither. Furthermore, any benefits or costs of fishers diversifying may be variable through time.  
  
Five species of salmon are harvested in Alaska waters (Chinook [*Oncorhynchus tshawytscha*], chum [*O. keta*], pink [*O. gorbuscha*], sockeye [*O. nerka*], coho [*O. kisutch*]), and the ability of individual salmon fishers to diversify across species is in part a function of state management areas and fishing gears. For example, salmon may be caught with purse seine gear (6 areas), drift gillnets (5 areas), or set gillnets (12 areas). Other gears include beach seine and troll gears, though these are generally restricted to Kodiak and Southeast Alaska. While multiple salmon species are targeted in some of these fisheries, there are also examples of fisheries where catch is dominated by a single species. Examples of specialization include fisheries that target sockeye salmon (e.g. Bristol Bay set and drift gillnet fisheries). For these fisheries, specialization is associated with higher revenue and reduced CV in year-to-year revenue [@anderson_benefits].  

Mechanisms responsible for incentivizing specialization or diversification have been reviewed by [@knapp_trends] - these include a number of exogenous drivers, such as competition from markets producing farmed salmon, consolidation of salmon buyers, marketing, prices, and new processing technology. In the late 1980s and early 1990s for example, salmon abundance was high and prices were low (in part due to collapses of foreign currencies). Following price declines into the early 2000s [@adfg2007], some of these trends have more recently reversed (i.e., increasing prices and catches, Figs. A5--A8). Processing technology, such as freezing, may increase competition within fisheries because fish caught in one year may be sold the next [@knapp_trends]. These effects are seen in relationships between harvests and prices, where large harvests of some species may negatively impact future prices (Supplementary Information). 

Perhaps one of the largest changes affecting the ability or incentive for fishers to diversify has been an increase in the production of hatchery fish. Increased hatchery production may alter the species composition of fish available to be targeted by particular gears, or affect incentives for fishers to target particular species by influencing prices. The modern era of Alaska's large-scale hatchery program began in the late 1970s in response to low returns [@stopha2016; @ward_evaluating], with substantial increases in hatchery releases during the 1980s following low returns [@mahnken1998; @leber2008]. Many of these hatchery programs increased production in an effort to stabilize the variability of salmon catches [@brooks1976; @hilborn2001a], and while recent work has suggested these programs may increase total yield [@amoroso2017], quantitative support for a reduction in variability at the level of fisheries or individuals remains unclear. Previous work has largely concentrated on the ecological effects of hatcheries [@hilborn1992a; @hilborn2001a; @wertheimer2001; @heard_hatchery; @ruggerone2015], or economic yield [@boyce1993; @leber2008]. Understanding the role salmon have in buffering or stabilizing fishing revenues is critical given the responses of salmon to variable ocean environments [@mueter2002; @schindler2010].  

The objectives of our analysis are to (1) evaluate long term trends in catch and revenue stability, (2) evaluate whether hatchery production has increased catch stability, and (3) better understand the effects of diversification on salmon permit holders by extending the time series models used by [@anderson_benefits] to include time-varying effects of diversification on the revenue and revenue variability of individual fishers. These time-varying effects of diversification will allow us to compare temporal trends across regions and to identify periods when having a diverse catch portfolio was most beneficial, which will allow better insight into the mechanisms through which diversification enables adaptation.

## Methods

### Data  
  
We obtained fisheries landings and revenue data for all permit holders in Alaska from 1985--2016 from the Commercial Fisheries Entry Commission (CFEC). Reported gross earnings (revenue) associated with each fish ticket -- a mandatory record provided by processors of the weight and species of the catch delivered at each landing -- were adjusted for inflation by converting all revenues to 2009 USD [@bea2016]. Each fish ticket was associated with both a vessel and individual fisher, and because of our focus on individuals, we aggregated data by individuals to generate annual summaries of catch diversity and revenue. Because our modeling focus involves estimating time-varying effects of diversification, we limited our analysis to salmon fisheries with species diversity > 1 (i.e. omitting fisheries such as the Bristol Bay gillnet fisheries that specialize on sockeye salmon). Fisheries were defined as groups of individual fishers with the same permit (Table 1).

```{r, echo=FALSE}
m = matrix("", 6, 4)
m[1,] = c("S01A", "Purse Seine", "Southeast Alaska", "Chum, pink")
m[2,] = c("S01E", "Purse Seine", "Prince William Sound", "Pink")
m[3,] = c("S01K", "Purse Seine", "Kodiak", "Pink, sockeye")
m[4,] = c("S01M", "Purse Seine", "Alaska Peninsula", "Pink, sockeye")
m[5,] = c("S03A", "Gillnet", "Southeast Alaska", "Chum")
m[6,] = c("S03E", "Gillnet", "Prince William Sound", "Sockeye")
colnames(m) = c("Fishery (permit)", "Gear", "Region", "Target spp. (2015)")
kable(m)
```

### Has increased hatchery production stabilized Alaskan salmon fisheries?
  
For consistency with previous work, we summarized stability by the catch (weight of salmon landed [@hilborn2001a; @knapp2007; @amoroso2017]), rather than revenue. Within each region in our analysis (Prince William Sound, Southeast, Kodiak, Alaska Peninsula), the hatchery contribution and total harvest are recorded by year for each species [@stopha2016; Fig. 3]. These quantities are not available at finer scales, such as for fisheries or individuals. Because annual reporting did not separate the Kodiak and Alaska Peninsula regions until after 1995, we these areas were grouped into a single region. 

There are several approaches for quantifying changes in variability and impacts of changes in hatchery practices. A two step model could be conducted, where a first model of salmon catches was constructed, and then the absolute residuals from that first model were used in a second model to examine changes in variability [@western2009]. Instead, we used a single model with simultaneous mean and variance regressions to describe the effects of hatchery contribution on the mean and year-to-year variability in catches. This type of model is a flexible extension of regression models known as variance function models (or heteroscedastic regression models, [@smyth1989]). We modeled the mean catch of each species in each region as, $$E[{ Y }_{ s,f,t }]={ Y }_{ s,f,t-1 }+{ b }_{ s,f }{ X }_{ s,f,t }$$ where ${ Y }_{ s,f,t-1 }$ is the observed catch of species $s$ in region $f$ in the previous time step $t-1$, ${ b }_{ s,f }$ is an estimated coefficient relating the contribution of hatchery fish to the mean catch, and ${ X }_{ s,f,t }$ is the change in proportion of hatchery contribution to the total catch for species *s* between times *t* and *t-1*. Catches in the previous year were included as an offset because these time series are not stationary (Fig. 3), making this approach similar to a model of first-differenced data. Because of this interpretation, we used the difference in hatchery contribution, rather than raw values, as the predictor. The hatchery-effect coefficients were modeled hierarchically, and we assumed that ${ b }_{ s,f }\sim \mathrm{Normal}\left( { u }_{ b },{ \sigma  }_{ b } \right)$, where ${ u }_{ b }$ and ${ \sigma  }_{ b }$ represent the location and scale hyperparameters.

To incorporate potential hatchery effects in the variability of salmon catches, the second component of our model included a hierarchical model on the process variance terms, $$log\left( { \sigma  }_{ s,f,t } \right) ={ g  }_{ 0,s,f }+{ g  }_{ 1,s,f }{ X }_{ s,f,t }$$ where ${ g  }_{ 0,s,f }$ represents an estimated intercept unique to each region and species, and ${ g  }_{ 1,s,f }$ represents a region- and species-specific slope. The covariate ${ X }_{ s,f,t }$ is identical to that used in the mean model. We included the intercepts ${ g  }_{ 0,s,f }$ as fixed effects (representing differences by species) and again modeled the hatchery effect as hierarchical, ${ g }_{ 1,s,f }\sim \mathrm{Normal}\left( { u }_{ g },{ \sigma  }_{ g } \right)$. The observed data were log-transformed and linked to the predicted mean and standard deviation with a normal likelihood, $ln\left( { Y }_{ s,f,t } \right) \sim \mathrm{Normal}\left( E\left[ ln\left( { Y }_{ s,f,t } \right)  \right] ,{ \sigma  }_{ s,f,t } \right)$. Previous authors, such as [@amoroso2017] have also considered the impacts of hatchery fish on variability in catches, but have examined changes in variability between two time periods, rather than modeled the variability continuously as we have here.
<!-- Sean: is there a reason why we are modeling the slope hierarchically but not the intercept? -->

We focused our inference on the slopes of the fraction of hatchery contribution to the mean and standard deviation of estimated annual catches, ${ b }_{ s,f }$ and ${ g }_{ 1,s,f }$. To allow for comparison across regions and scales of data, we converted these estimates to effect sizes, by calculating ${ \kappa  }_{ s }=ln\left( \frac { { g }_{ 0,s }+{ 0.2 \cdot g }_{ 1,s } }{ { g }_{ 0,s } }  \right)$. The term ${ \kappa  }_{ s }$ then represents the approximate percent change in the standard deviation resulting from a 20% increase in the hatchery contribution. 95% credible intervals were generated by repeating this calculation for each MCMC draw, and taking the quantiles of the resulting distribution. 

### Have effects of diversification changed over time for individual salmon fishers?

Because we are focused on single permit fisheries, we applied a simplified version of the CFEC data filtering steps described in [@anderson_benefits]. Individual trip-level catch and revenue data from 1975-2016 were aggregated to annual data for each fisher, because we are interested in diversification within fisheries, we restricted our analysis to only included individual fishers who participated in a single fishery in a year (Table 1). To avoid complications in modeling individuals switching permits between consecutive years, pairs of years where individuals changed strategies (switched or aquired additional permits) were not included. @anderson_benefits implemented a hierarchical Bayesian time series model that incorporated group-level predictors and allowed individual covariates (diversity of catch, days fished) to simultaneously affect the mean and variance of revenue for individual fishers. This model also included random intercepts on the mean by fishery and year, allowing all permit holders in a given year to experience common fluctuations due to external drivers such as price changes, fluctuations in fish population abundance, or environmental disasters such as the Exxon Valdez oil spill. 

To address how economic benefits of diversification may have changed over time for individuals in salmon fisheries in Alaska, we extend the model of [@anderson_benefits] to include time-varying random effects in the slope coefficients of diversification. Letting these effects vary through time allows unmodeled exogenous drivers such as price shocks, to impact the benefits of catch diversification. We used the effective catch diversity, calculated as the reciprocal of Simpson's diversity [@anderson_benefits; @kasperski2013]. Effective diversity values near 1.0 indicate that an individual's revenue is dominated by a single species, whereas an effective diversity of 3.0 would indicate that three species contribute equally to that individual's annual revenue.

Following [@anderson_benefits], we simultaneously model the annual revenue and revenue variability. Our model for the expected log revenue of individual *i* in year *t* is $${ \log  \left( { R }_{ i,t } \right)  } ={ B }_{ 0,j,t }+{ B }_{ 1,j,t }\cdot \Delta S_{ i,t }+{ B }_{ 2,j,t }\cdot \left( \Delta S_{ i,t }\cdot { S }_{ i,t-1 } \right) + { B }_{ 3,j }\cdot \Delta D_{ i,t }+\log  \left( { R }_{ i,t-1 } \right)$$ where *j* subscripts the salmon permit (Table 1). We define the variables $\Delta { S }_{ t }=\log\left( { S }_{ t }/{ S }_{ t-1 } \right)$ to represent the percent change in species diversity of the catch between years and $\Delta { D }_{ t }=\log\left( { D }_{ t }/{ D }_{ t-1 } \right)$ to represent the percent change in fishing effort (days fished) between years. The time-varying intercepts, specific to each permit, are modeled as random and exchangeable across years, ${ B }_{ 0,j,t }\sim \mathrm{Normal}\left( { u }_{ { B }_{ 0 } },{ \sigma  }_{ { B }_{ 0 } } \right)$. The term ${ B }_{ 1,j,t }$ represents the permit-level random effect of adjusting catch diversity. We also include the interaction terms $\Delta S_{ t }\cdot { S }_{ t-1 }$, which allow the effect of diversifying to be dependent on the previous level of diversification. This relationship is assumed to be linear, and the coefficients ${ B }_{ 1,j,t }$ and ${ B }_{ 2,j,t }$ allow this to vary by permit and through time. Like @anderson_benefits, we did not include main effect terms for ${ S }_{ t-1 }$, because the expectation of log-differenced revenue was assumed to be zero, regardless of prior catch diversity. The flexibility in this approach allows the benefit of increasing species diversity to be positive in some years (generalizing benefits revenue), negative in other years (specializing benefits revenue) and neutral in other years (revenue is independent of alterations to catch composition). We constrain the random effects associated with diversification to be modeled as independent by year (not autoregressive) with shared variances across strategies, for example: ${ B }_{ 1,j,t }\sim \mathrm{Normal}\left( 0, { \sigma  }_{ { B }_{ 1 } } \right)$. As in @anderson_benefits, we also allow the effect of changing effort (measured as percent change in days fished) ${ B }_{ 3,j }$ to vary by strategy, but we do not allow this effect to vary through time. Finally, the term $\log\left( { R }_{ i,t-1 } \right)$ is included as an offset (covariate with an effect set to 1).
<!-- Sean: Is B_3,j modeled hierarchically? 
-->

Following @anderson_benefits, we simultaneously estimated the effects of covariates on the variance model. While conventional hierarchical linear regression assumes variances to be constant or shared by grouping variables, we also included fixed and random covariates on the variance, making the model akin to variance function regression or stochastic volatility models [@smyth1989; @western2009]. We can express the log standard deviation as $$\log\left( { \sigma  }_{ i,t } \right)={ G }_{ 0,j }+{ G }_{ 1,j,t }\cdot \Delta S_{ i,t }+{ G }_{ 2,j,t }\cdot \left( \Delta S_{ i,t }\cdot { S }_{ i,t-1 } \right) +G_{ 3,j }\cdot \Delta D_{ i,t }$$. Unlike the linear model for the mean, an offset term is not included for the variance. Furthermore, we constrained the variance intercepts ${G}_{0,j}$ to be temporally constant by strategy. Like the mean model, the random effects were constrained to be autoregressive, ${ G }_{ 1,j,t }\sim \mathrm{Normal}\left( 0, { \sigma  }_{ { G }_{ 1 } } \right)$, and covariates associated with days fished and species diversity were included as predictors.
<!-- Sean: and modeled hierarchically? -->

### Estimation  

Estimation for both sets of models was done in a Bayesian framework using R [@rcoreteam2016] and the package `rstan`, implementing Markov chain Monte Carlo (MCMC) using the No-U Turn Sampling (NUTS) algorithm [@hoffman2014; @standevelopmentteam2016; @standevelopmentteam2016a]. Runs for each model included 3-4 MCMC chains, with a burn-in (warmup) period of 4000 samples, followed by 5000 iterations. Code to replicate our analysis, including additional diagnostics plots, and additional models is available at [https://github.com/NCEAS/pfx-commercial-salmon].

## Results

General trends in limited-entry salmon fisheries since the early 2000s are that more individuals have been participating, landings are increasing, revenue is increasing slightly, and effective species diversity is declining over time (Fig. 1; Figs. A1-A4). Across salmon fisheries, there appears to be little correlation between catch diversity and revenue (Fig. A2), though fisheries cluster similarly by gear on axes of risk (CV of annual revenue) and return  (mean annual revenue, Fig. 2). 
Across species and regions we found no consistent support for the hypothesis that variability in salmon catches has been stabilized by increased hatchery production. Across fisheries in the four regions in our analysis, most estimates of hatchery production on changes in the mean total catch are near zero (Fig. 4). One exception is a slight negative estimated effect of hatcheries on Chinook catches in Southeast Alaska, though this effect may be spurious - particularly if other unmodeled factors changed at the same time. The strongest positive correlations between hatchery contribution and variability in catches appeared to be for coho and pink salmon in PWS (Fig. 4). The 95% credible intervals for these estimates overlap zero however, and the estimated effect sizes are small in magnitude (a 20% increase in hatchery fish results in < 20% increase in the standard deviation of catches).

Most fishers participating in the six salmon fisheries in our analysis experience changes in effective catch diversity that are typically between +/- 1 (Fig. A5). Our model of individual revenues and revenue variability suggests that diversity in these six fisheries have declined over time (Figs. A3--A4), and higher revenue has been increasingly associated with increased specialization (Fig. 5). The negative estimated effects on mean revenue of increasing diversity implies that for the majority of these fisheries in most years, revenue increases when individuals specialize, rather than diversify. The slight negative trends in these estimated effects for some fisheries (PWS and SEAK drift gillnet) suggest that the benefits of specializing on revenue have also increased over time (Fig. 5). More importantly, our estimates suggest that individuals experience rapidly changing incentives to diversify over time. From 2008--2010 for example, it was not beneficial for individuals in the PWS or SE seine fisheries to diversify (negative effects in Fig. 5), but several years later these trends changed slightly positive for seine fisheries, indiciating a more diverse catch translated into higher revenue (Fig. 5). [Note: worth doing comparison of even-odd years? EW: Difficult because dominance not strong 2-year cycle]

Our results also showed contrasts in year-to-year variability between seine and gillnet fisheries, with individuals in seine fisheries experiencing higher annual variability in revenue (Figs. 2, A6). These results are expected, because across individual fishers, seine fisheres are generally higher on axes of risk and return (CV of annual revenue, mean annual revenue; Fig. 2). Though the catch composition of each of these fisheries has fluctuated through time, in areas where seine and gillnet fisheries exist (Prince William Sound, Southeast Alaska), effective catch diversity is slightly higher in gillnet fisheries (Figs A3--A4).  

We found little evidence that individuals who increased catch diversity reduced their variability in revenue for most fisheries (Fig. A7). For several fisheries (SE seine and gillnet, PWS seine), there have been periods over the last several decades where diversification has increased variability, such as the mid-2000s (Fig. A7). For most other fisheries, these effects of diversifying are near zero or slightly positive (Fig. A7). Since 2010 for example, the effects of increasing catch diversity have translated to an increase in revenue variability for individuals participating in fisheries in PWS or the SE seine fishery (Fig. A7).

## Discussion

Understanding the mechanisms responsible for trends or variability in the revenue of individuals whose incomes are dependent on natural resources is important for coupled social-ecological systems, because their income variability is typically greater than that of the larger population [@mishra2002; @sethi2012]. Unlike terrestrial farmers, commercial fishers are often constrained by regulations that can limit the number of individuals who can participate, where fishing occurs, what type of gear is used, or when fishing occurs. Individuals participating in many of the commercial salmon fisheries in Alaska may have the option to increase the diversity of their catches. Examining long-term trends in catch diversity for seine and gillnet fisheries in our analysis illustrates that most salmon fisheries have become less diverse over time. In recent years, catches from several of these fisheries have been dominated by a single species, namely sockeye salmon in the Prince William Sound gillnet fishery, pink salmon in the Prince William Sound seine fishery, and chum salmon in the Southeast Alaska gillnet fishery (Figs. A3--A4).

As in other commercial fisheries, the ability of salmon fishers to diversify within the constraints of their permits may be largely driven by factors beyond their control. The limited options of salmon fishers in Alaska to diversify may include fishing in different months or different regions. For example, individuals participating in the Prince William Sound seine fishery may fish earlier in the year to target chum salmon. External incentives for salmon fishers to specialize or diversify are complex, and include a suite of economic factors: competition from foreign markets, prices from processors, fuel costs, and marketing (e.g. increased marketing of Copper River sockeye salmon beginning in the early 1980s) [@knapp_trends]. A potential driver unique to Alaska salmon fisheries is the potential impacts of hatchery salmon. Increased hatchery production may alter the species composition that individual fishers encounter, as well as the prices set by processors. [Note: expand on this last sentence]

Results from our variance function model of individual revenues over the period 1975--2016 suggest that there have been long-term increases in the benefits of individual fishers specializing (i.e., expected revenue increases when catch diversity decreases; Fig. 5). For most of the time series, the impacts of changes to catch diversity on variability in year-to-year revenue are less clear. A counter-intuitive result is that since the mid-2000s, fisheries in Prince William Sound and seine fisheries in Southeast Alaska have had an estimated increase in revenue variability associated with diversification. Some of this relationship may be spurious, in that individuals who have large reductions in catch diversity may harvest less (Fig. A8). Mechanisms responsible for reduced harvest may include illness or gear / vessel malfunctions. But another driver may be increased consolidation from processors. Prices of all salmon have generally increased since the early 2000s, with some of the largest changes being in pink and chum salmon prices. In areas with high pink or chum salmon runs, the benefits of diversification may have been greatest when these species had low returns. For pink salmon returns with strong 2-year oscillations for example, this would correspond to even- versus odd-years.

An additional potential impact of increased hatchery production may be changes in the variability of catches or revenues, to fisheries or individuals. Across multiple regions in Alaska, we found little support for catches becoming more stable as hatchery programs have increased. One example of a positive correlation between the hatchery contribution to harvest and variability is pink salmon in Prince William Sound (Fig. 4). Our model describing the revenues of individual fishers also suggests that individuals in the Prince William Sound seine fishery have higher year-to-year variability relative to other fisheries (Fig. A6), with year to year changes being correlated with fluctuations in pink salmon returns (Fig. A9).

The increased specialization of Alaska fisheries has been highlighted in several recent analyses [@kasperski2013; @anderson_benefits; @sethi2012], and our analysis extends this work to show similar trends within individual Alaskan salmon fisheries. In terrestrial agriculture, there are multiple examples of year-to-year income variability being stabilized by diversification [@difalco2003], but these incentives become more complex at larger scales. Crop diversification in developed countries is shaped by a number of drivers including changing national policies, technology, and increased demand from other parts of the world (e.g. U.S. production of soybeans for Asian countries) [@bradshaw2004; @aguilar2015]. Shifts in terrestrial agriculture from a diverse mix of low- and high-value crops to focusing on high-volume low-value crops (such as soybeans or cereals) may have parallels for Alaskan salmon fisheries -- particularly those fisheries that have more recently targeted low-value species with rapid life histories (pink, chum salmon). 
Increasing trends toward specialization in Alaska salmon fisheries may be acceptable for fishers if individuals are willing to accept the additional risk that may accompany larger revenues, particularly when prices and abundances are high. Variability in the revenues that individuals or communities experience is product of many complex drivers, including management, market forces, and environmental variation. While reducing risks to individual fisher revenues is not something that can currently be managed for, understanding patterns of variability that individuals experience is essential for quantifying changing revenue patterns at higher levels of fisheries and coastal communities, and protecting individuals from future economic shocks. 

[Note: AB: things to add to discussion:	Diversification beyond salmon fisheries (in other words, salmon isn’t the whole portfolio)
Any other studies that might support results for hatchery effect on catch
]

[Note: AH: Seems like something to add is that as the value of single permits increase, the cost of adding another would increase.  So that specialization is likely to be self-reinforcing.   This might be a point more for Sean’s paper really, but seems like it applies here too.]

\break  

```{r fig1, echo=FALSE, fig.pos="placeHere", fig.cap="Trends in participation, landed catch, mean annual revenue, and effective species diversity for eight selected Alaska salmon fisheries. "}
# trends in participation, 
cfec_all = readRDS("../data-generated/salmon_data_for_paper.rds")
people = group_by(cfec_all, p_fshy, year) %>% 
  summarize(n = length(unique(p_holder))) %>% 
  filter(substr(p_fshy,1,1)=="S")
people$p_fshy = paste0(substr(people$p_fshy,1,1), substr(people$p_fshy,3,5))
names(people)[which(names(people)=="p_fshy")]="Permit"

people2 = people[people$Permit%in%c("S01K","S01M","S01E","S01A","S03A","S03E","S03T","S05B"),]
people2$Permit[which(people2$Permit=="S01K")] = "KO-seine"
people2$Permit[which(people2$Permit=="S01M")] = "AP-seine"
people2$Permit[which(people2$Permit=="S01E")] = "PWS-seine"
people2$Permit[which(people2$Permit=="S01A")] = "SE-seine"
people2$Permit[which(people2$Permit=="S03A")] = "SE-drift"
people2$Permit[which(people2$Permit=="S03E")] = "PWS-drift"
people2$Permit[which(people2$Permit=="S03T")] = "BB-drift"
people2$Permit[which(people2$Permit=="S05B")] = "State-troll"

people2 = rename(people2, permit = Permit)
people2 = rename(people2, value = n)
people2$value = log10(people2$value)
people2$datatype = "log10 (permit holders)"

# trends in landed weight - metric tons
weight = group_by(cfec_all, p_fshy, year) %>% 
  summarize(w = sum(g_pounds,na.rm=T) * 0.000453592) %>% 
  filter(substr(p_fshy,1,1)=="S")
weight$p_fshy = paste0(substr(weight$p_fshy,1,1), substr(weight$p_fshy,3,5))
names(weight)[which(names(weight)=="p_fshy")]="Permit"

weight = left_join(weight, people)

weight2 = weight[weight$Permit%in%c("S01K","S01M","S01E","S01A","S03A","S03E","S03T","S05B"),]
weight2$Permit[which(weight2$Permit=="S01K")] = "KO-seine"
weight2$Permit[which(weight2$Permit=="S01M")] = "AP-seine"
weight2$Permit[which(weight2$Permit=="S01E")] = "PWS-seine"
weight2$Permit[which(weight2$Permit=="S01A")] = "SE-seine"
weight2$Permit[which(weight2$Permit=="S03A")] = "SE-drift"
weight2$Permit[which(weight2$Permit=="S03E")] = "PWS-drift"
weight2$Permit[which(weight2$Permit=="S03T")] = "BB-drift"
weight2$Permit[which(weight2$Permit=="S05B")] = "State-troll"

weight2$wn = log10(weight2$w/weight2$n)
weight2 = rename(weight2, permit=Permit, value = wn)
weight2$datatype = "log10 (avg. mt)"
datf = as.data.frame(rbind(people2[,c("permit","year","value","datatype")],
  weight2[,c("permit","year","value","datatype")]))

# trends in revenue
dat.annual = readRDS(file="../data-generated/salmon-annual-for-modeling.rds")
dat.annual = group_by(dat.annual[which(dat.annual$strategy_permit %in% c("S01A", "S01E", "S01K", "S01M", "S03A", "S03E", "S03T", "S05B")),], year, strategy_permit) %>% 
  summarize(meanrev = mean(revenue), meandiv = mean(specDiv))
names(dat.annual)[which(names(dat.annual)=="strategy_permit")]="Permit"
dat.annual = left_join(dat.annual, weight)

dat.annual2 = dat.annual[dat.annual$Permit%in%c("S01K","S01M","S01E","S01A","S03A","S03E","S03T","S05B"),]
dat.annual2$Permit[which(dat.annual2$Permit=="S01K")] = "KO-seine"
dat.annual2$Permit[which(dat.annual2$Permit=="S01M")] = "AP-seine"
dat.annual2$Permit[which(dat.annual2$Permit=="S01E")] = "PWS-seine"
dat.annual2$Permit[which(dat.annual2$Permit=="S01A")] = "SE-seine"
dat.annual2$Permit[which(dat.annual2$Permit=="S03A")] = "SE-drift"
dat.annual2$Permit[which(dat.annual2$Permit=="S03E")] = "PWS-drift"
dat.annual2$Permit[which(dat.annual2$Permit=="S03T")] = "BB-drift"
dat.annual2$Permit[which(dat.annual2$Permit=="S05B")] = "State-troll"

dat.annual2 = rename(dat.annual2, permit=Permit)

dat.annual2$meanrev = log10(dat.annual2$meanrev)
tempd = as.data.frame(dat.annual2[,c("permit","year","meanrev")])
names(tempd) = c("permit","year","value")
tempd$datatype = "log10 (revenue)"
datf = rbind(datf, tempd)

tempd = as.data.frame(dat.annual2[,c("permit","year","meandiv")])
names(tempd) = c("permit","year","value")
tempd$datatype = "Catch diversity"
datf = rbind(datf, tempd)

datf = rename(datf, Permit = permit)

datf$value[which(datf$year==1989 & datf$Permit == "KO-seine")] = NA

ggplot(datf, aes(year, value, color = Permit, group = Permit)) + geom_line() + ylab("") + xlab("Year") + facet_wrap(~datatype, scale="free_y") + theme_bw() + theme(panel.border = element_blank(), panel.grid.major = element_blank(), panel.grid.minor = element_blank(), axis.line = element_line(colour = "black"))

```
  
\break  

<!-- TODO Sean: I guess we need to make sure we defined these regions either here or in a table -->
```{r fig2, echo=FALSE, fig.pos="placeHere", fig.cap="CV and mean annual revenue by salmon permit, 1975--2016. Effective species diversity of catch is shown by circle area (effective species diversity = 1 / Simpson's diversity), and fishing gear type are shown with color shading. Labels indicate regions.", warning=FALSE, message=FALSE}

dat.annual <- read.table("../data-generated/bubble_plot_data_fig2.csv", stringsAsFactors = FALSE, header = TRUE)

dat.annual <- mutate(dat.annual,
  gear = factor(gear, levels = c("Drift gillnet", "Set gillnet", "Hand troll", "Power troll", "Purse seine")))

l <- tibble::tribble(~let, ~label,
  "H", "CI",
  "E", "PWS",
  "L", "CH",
  "K", "KO",
  "M", "AP",
  "T", "BB",
  "A", "SE",
  "B", "State",
  "Z", "NS",
  "W", "KU",
  "D", "YAK",
  "Y", "YUK")

dat.annual <- mutate(dat.annual,
  let = sub("S[0-9]+([A-Z])", "\\1", dat.annual$strategy_permit)) %>%
  left_join(l) %>%
  filter(strategy_permit != "S04Y")

g <- ggplot(dat.annual,
  aes(x = mean_rev/1e3, y = cv_rev,
    label = label)) +
  geom_point(alpha = 0.5, aes(fill = gear, size = diversity), pch = 21,
    colour = "grey20") +
  scale_size(range = c(1.5, 15), breaks = seq(1.2, 2.4, 0.4)) +
  guides(fill = guide_legend(override.aes = list(size = 4, alpha = 0.7), order = 1)) +
  geom_text_repel(size = 2.6, colour = "grey20",
    alpha = 1, segment.color = "grey70",
    point.padding = unit(0, "lines"), max.iter = 1e4, segment.size = 0.3) +
  scale_fill_brewer(palette = "Set3") +
  ylab("CV annual revenue") + xlab("Mean revenue ($1000)") +
  labs(fill = "Gear", size = "Diversity") +
  scale_y_continuous(breaks = seq(0.2, 1, 0.2)) +
  theme_sleek() #+
  # scale_x_log10()
print(g)
```

  
\break  
  
```{r fig3, echo=FALSE, fig.pos="placeHere", fig.cap="Harvest of hatchery-produced salmon through time by species and area. Shown are the numbers of hatchery fish caught by fisheries (top row), and the hatchery contribution of each species to total catch (bottom row). Areas represents combined Kodiak and Alaska Peninsula ('KO - AP'), Southeast ('SE') and Prince William Sound ('PWS'). "}

seak_hatch = read.csv("../data-generated/seak_hatcheryHarvest.csv")
pws_hatch = read.csv("../data-generated/pws_hatcheryHarvest.csv")
kodiak_hatch = read.csv("../data-generated/kodiak_hatcheryHarvest.csv")

seak_hatch = melt(seak_hatch, id.vars = c("Year"))
pws_hatch = melt(pws_hatch, id.vars = c("Year"))
kodiak_hatch = melt(kodiak_hatch, id.vars = c("Year"))

seak_hatch$region = "SE"
pws_hatch$region = "PWS"
kodiak_hatch$region = "KO - AP"

seak_hatch$value[is.na(seak_hatch$value)] = 0
pws_hatch$value[is.na(pws_hatch$value)] = 0
kodiak_hatch$value[is.na(kodiak_hatch$value)] = 0

dat = bind_rows(seak_hatch, pws_hatch)
dat = bind_rows(dat, kodiak_hatch)

names(dat)[which(names(dat)=="variable")]="species"
dat$value = dat$value / 1000000

# chinook chum coho pink sock
cbPalette <- c("#009E73", "#4B2E83", "#999999", "#CC79A7", "#D55E00")

dat$col = as.numeric(as.factor(dat$species))
g1 = ggplot(dat, aes(Year, value)) +
  geom_area(aes(fill = species), position = "stack") +
  xlab("Year") + ylab("Hatchery harvest (millions)") +
  scale_fill_manual(values = c('Chinook'=cbPalette[1], 'Chum'=cbPalette[2], 
    'Coho'=cbPalette[3], 'Pink'=cbPalette[4], 'Sockeye'=cbPalette[5]), name="Species",
    labels =c("Chinook","Sockeye","Coho","Pink","Chum")) + 
  facet_wrap(~region, scale="free_y") + theme_bw() + theme(panel.border = element_blank(), panel.grid.major = element_blank(), panel.grid.minor = element_blank(), axis.line = element_line(colour = "black"))

# bring in total harvest data (hatchery + wild)
hatch = read.csv("../data-generated/commonPropertyCommercialCatch.csv",
  stringsAsFactors = FALSE)

kodap1 = hatch[which(hatch$Region%in%c("Kodiak") & hatch$Year <= 1995),]
kodap2 = hatch[which(hatch$Region%in%c("AP", "Kodiak") & hatch$Year > 1995),]
kodap2 = dplyr::group_by(kodap2, Year) %>% 
  summarize(Chinook_harvest = sum(Chinook_harvest),
    Sockeye_harvest = sum(Sockeye_harvest),
    Coho_harvest = sum(Coho_harvest),
    Pink_harvest = sum(Pink_harvest),
    Chum_harvest = sum(Chum_harvest),
    Region = Region[1],
    Source = Source[1],
    ReportNumber = ReportNumber[1],
    Chinook_enhanced = sum(Chinook_enhanced),
    Sockeye_enhanced = sum(Sockeye_enhanced),
    Coho_enhanced = sum(Coho_enhanced),
    Pink_enhanced = sum(Pink_enhanced),
    Chum_enhanced = sum(Chum_enhanced))
kodap = rbind(as.data.frame(kodap1), as.data.frame(kodap2))
kodap$Region = as.character(kodap$Region)
kodap$Source = as.character(kodap$Source)
kodap$ReportNumber = as.character(kodap$ReportNumber)

hatch = rbind(hatch[which(hatch$Region %in% c("PWS","Southeast")),], kodap)

hatch$pChinook = hatch$Chinook_enhanced/hatch$Chinook_harvest
hatch$pSockeye = hatch$Sockeye_enhanced/hatch$Sockeye_harvest
hatch$pCoho = hatch$Coho_enhanced/hatch$Coho_harvest
hatch$pPink = hatch$Pink_enhanced/hatch$Pink_harvest
hatch$pChum = hatch$Chum_enhanced/hatch$Chum_harvest

hatch = hatch[,c("Year","pChinook","pSockeye","pCoho","pPink","pChum","Region")]
hatch = dplyr::rename(hatch, Chinook=pChinook,Sockeye=pSockeye, Coho=pCoho, Pink=pPink, Chum=pChum)
hatch$Region = as.character(hatch$Region)
hatch$Region[which(hatch$Region=="PWS")] = "PWS"
hatch$Region[which(hatch$Region=="Kodiak")] = "KO - AP"
hatch$Region[which(hatch$Region=="Southeast")] = "SE"
hatch = melt(hatch, id.vars = c("Year","Region"))
names(hatch)[which(names(hatch)=="variable")]="Species"

g2 = ggplot(hatch, aes(Year, value, color=Species)) + 
  geom_line() + facet_wrap(~Region) + 
  xlab("Year") + ylab("Hatchery fraction of total catch") + 
  scale_color_manual(values = c('Chinook'=cbPalette[1], 'Chum'=cbPalette[2], 
    'Coho'=cbPalette[3], 'Pink'=cbPalette[4], 'Sockeye'=cbPalette[5]), name="Species",
    labels =c("Chinook","Sockeye","Coho","Pink","Chum")) + theme_bw() + theme(panel.border = element_blank(), panel.grid.major = element_blank(), panel.grid.minor = element_blank(), axis.line = element_line(colour = "black"))

gridExtra::grid.arrange(g1, g2)

# join datasets together for modeling
names(dat) = tolower(names(dat))
names(hatch) = tolower(names(hatch))
names(dat)[which(names(dat)=="value")] = "hatchery_harvest_millions"
names(hatch)[which(names(hatch)=="value")] = "percent_hatchery"
dat = left_join(dat, hatch)
dat$total_harvest = dat$hatchery_harvest_millions / (dat$percent_hatchery/100)
saveRDS(dat, file="../data-generated/hatchery_harvest_millions.rds")
```
  
\break  

```{r fig4, echo=FALSE, fig.pos="placeHere", fig.cap="Effects of the fraction of hatchery fish on (1) mean annual catches, and (2) standard deviation of annual catches, for three areas ('KO' = Kodiak, 'PWS' = Prince William Sound, 'SE' = Southeast). Effect sizes are presented as the percentage change from an increase from 0% to 20% hatchery fish. Dots represent mean estimates and error bars represent 95% CIs."}

df = readRDS(file=paste0("../data-generated/","region","_df.rds"))
cbPalette <- c("#009E73", "#4B2E83", "#999999", "#CC79A7", "#D55E00")

df$fishery[which(df$fishery=="Prince William Sound")] = "PWS"
df$fishery[which(df$fishery=="SEAK")] = "SE"
df$fishery[which(df$fishery=="Kodiak")] = "KO"

p1 = ggplot(df, aes(x=fishery, y=bestimate, group=species, color=species)) +
  geom_point(position=position_dodge(0.5), alpha = 0.5, size=3) +
  ylab("Effect size (mean)") +
  xlab("") +
  geom_errorbar(aes(ymin=bestimate-1.96*bsd, ymax=bestimate+1.96*bsd),
    position=position_dodge(0.5), alpha=0.5) +
  scale_color_manual(values = c('Chinook'=cbPalette[1], 'Chum'=cbPalette[2],
    'Coho'=cbPalette[3], 'Pink'=cbPalette[4], 'Sockeye'=cbPalette[5]), name="Species",
    labels =c("Chinook","Sockeye","Coho","Pink","Chum"))+
  geom_hline(aes(yintercept=0), linetype = 2) +
  theme_bw() +
  theme(panel.border = element_blank(), panel.grid.major = element_blank(),
    panel.grid.minor = element_blank(), axis.line = element_line(colour = "black")) + coord_flip() + theme(legend.position="none") + ylim(c(-0.4,0.4))

p2 = ggplot(df, aes(x=fishery, y=estimate, group=species, color=species)) +
  geom_point(position=position_dodge(0.5), alpha = 0.5, size=3) +
  ylab("Effect size (sd)") +
  xlab("") +
  geom_errorbar(aes(ymin=estimate-1.96*sd, ymax=estimate+1.96*sd),
    position=position_dodge(0.5), alpha=0.5) +
  scale_color_manual(values = c('Chinook'=cbPalette[1], 'Chum'=cbPalette[2],
    'Coho'=cbPalette[3], 'Pink'=cbPalette[4], 'Sockeye'=cbPalette[5]), name="Species",
    labels =c("Chinook","Sockeye","Coho","Pink","Chum"))+
  geom_hline(aes(yintercept=0), linetype = 2) +
  theme_bw() +
  theme(panel.border = element_blank(), panel.grid.major = element_blank(),
    panel.grid.minor = element_blank(), axis.line = element_line(colour = "black")) + coord_flip() + ylim(c(-0.4,0.4))

plot_grid(p1, p2, align = "h", nrow = 1, rel_widths = c(0.43, 0.57))
#gridExtra::grid.arrange(p1, p2, nrow=1)
```

\break  
  
```{r fig5, fig.pos="placeHere", fig.cap="Time-varying effects of increasing the effective species diversity of catch (1/Simpson's diversity) from 1 to 2 species (presented as log ratio).", echo=FALSE}
# make yearpermit df
diffdat = readRDS(file="../data-generated/salmon.rds")
years = seq(min(diffdat$year), max(diffdat$year))
permits = levels(as.factor(diffdat$permit))
# note that we have to use factor() here instead of unique() because
# that's the same as the ordering in the estimation code
yearpermit = data.frame("yrpermit"=levels(as.factor(diffdat$year_permit)))
yearpermit$year = as.numeric(substr(yearpermit$yrpermit,1,4))
yearpermit$permit = substr(yearpermit$yrpermit,6,9)

# grab original data to look at permit names
diffdat = readRDS(file="../data-generated/salmon-diff-for-modeling.rds")
years = seq(min(diffdat$year), max(diffdat$year)) 
#permits = levels(as.factor(diffdat$permit))

yearpermitold=yearpermit
load("../analysis/model-linear-iid.Rdata")
yearpermit=yearpermitold

est = extract(mod, permute="TRUE")

# start with making time series of estimates on mean
# challenge is that they're time varying quadratic functions
# do facet_wrap of estimates by year

# effect of adding more 1 species from 1. specdiv.prev = 1

specdiv.prev = seq(1, 5, by=0.1)
specdiv = specdiv.prev + 1 # always add 1 more in these comparisons
x1 = log(specdiv/specdiv.prev)
x2 = log(specdiv/specdiv.prev) * specdiv.prev
x3 = log(specdiv/specdiv.prev) * specdiv.prev^2

df = expand.grid("year"=1:length(years), "diversity" = seq(1,length(x1)), "permit"=1:6)
df$permits = permits[df$permit]
df$years = years[df$year]
df$x = specdiv.prev[df$diversity]
df$pred = 0
df$low = 0
df$high = 0
b0_indx = match(paste(as.character(df$years), as.character(df$permits)), as.character(yearpermit$yrpermit)) 
for(i in 1:nrow(df)) {
  #tmp = est$b0_str_yr[,b0_indx[i]] + 
  tmp = 
    x1[df$diversity[i]] * (est$b_1[,df$year[i], df$permit[i]])# +
    #x2[df$diversity[i]] * (est$b_2[,df$year[i], df$permit[i]]+est$b2_str_yr_mu)# +
    #x3[df$diversity[i]] * (est$b_3[,df$year[i], df$permit[i]]+est$b3_str_yr_mu)
  df$pred[i] = mean(tmp)
  df$low[i] = quantile(tmp,0.025)
  df$high[i] = quantile(tmp,0.975)
}

df$permits[which(df$permits=="S01A")] = "SE-seine"
df$permits[which(df$permits=="S01E")] = "PWS-seine"
df$permits[which(df$permits=="S01K")] = "KO-seine"
df$permits[which(df$permits=="S01M")] = "AP-seine"
df$permits[which(df$permits=="S03A")] = "SE-drift"
df$permits[which(df$permits=="S03E")] = "PWS-drift"

ggplot(df[df$diversity==1,], aes(x=years,y=pred,group=permits)) +
  geom_ribbon(aes(ymin=low,ymax=high), fill="blue",alpha=0.4) +
  geom_line(col="blue") + 
  facet_wrap(~permits) + xlab("Year") + ylab("Effect of increased catch diversity on mean revenue") + geom_hline(yintercept=0, color="red", linetype = 2, alpha = 0.3) + theme_bw() + theme(panel.border = element_blank(), panel.grid.major = element_blank(), panel.grid.minor = element_blank(), axis.line = element_line(colour = "black"))

```

\break 
\break  
  
# References
